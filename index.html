hands.onResults(results => {
    ctx.clearRect(0,0,100,75);
    ctx.drawImage(results.image, 0, 0, 100, 75);

    const handsCount = results.multiHandLandmarks.length;
    loveText.style.opacity = 0; // m·∫∑c ƒë·ªãnh ·∫©n

    // =========================
    // ‚ù§Ô∏è 2 TAY ‚Üí TR√ÅI TIM
    // =========================
    if (handsCount === 2) {
        const lm1 = results.multiHandLandmarks[0];
        const lm2 = results.multiHandLandmarks[1];

        // kho·∫£ng c√°ch gi·ªØa 2 ng√≥n tr·ªè
        const distIndex = Math.hypot(
            lm1[8].x - lm2[8].x,
            lm1[8].y - lm2[8].y
        );

        // kho·∫£ng c√°ch gi·ªØa 2 ng√≥n c√°i
        const distThumb = Math.hypot(
            lm1[4].x - lm2[4].x,
            lm1[4].y - lm2[4].y
        );

        if (distIndex < 0.1 && distThumb < 0.15) {
            state = 'TREE';
            statusDiv.innerText = "‚ù§Ô∏è I love you";
            statusDiv.style.color = "#ff4d6d";
            loveText.style.opacity = 1;
            return;
        }
    }

    // =========================
    // ‚úã 1 TAY
    // =========================
    if (handsCount === 1) {
        const lm = results.multiHandLandmarks[0];
        handX = lm[9].x;

        const tips = [8,12,16,20];
        const wrist = lm[0];

        let openDist = 0;
        tips.forEach(i => {
            openDist += Math.hypot(lm[i].x - wrist.x, lm[i].y - wrist.y);
        });
        const avgDist = openDist / 4;

        const pinchDist = Math.hypot(
            lm[4].x - lm[8].x,
            lm[4].y - lm[8].y
        );

        // ‚úä N·∫ÆM TAY ‚Üí THU C√ÇY
        if (avgDist < 0.25) {
            state = 'TREE';
            statusDiv.innerText = "‚úä Thu c√¢y";
            statusDiv.style.color = "#FFD700";
            return;
        }

        // üëå PINCH ‚Üí ZOOM ·∫¢NH (GI·ªÆ NGUY√äN)
        if (pinchDist < 0.05) {
            state = 'PHOTO';
            statusDiv.innerText = "üëå Xem ·∫£nh";
            statusDiv.style.color = "#00FFFF";
            return;
        }

        // üñê XO√à TAY ‚Üí BUNG C√ÇY
        state = 'EXPLODE';
        statusDiv.innerText = "üñê Bung c√¢y";
        statusDiv.style.color = "#FFA500";
        return;
    }

    // =========================
    // KH√îNG PH√ÅT HI·ªÜN TAY
    // =========================
    state = 'TREE';
    statusDiv.innerText = "üéÑ Gi√°ng sinh an l√†nh üéÑ";
    statusDiv.style.color = "#FFF";
});
